import{a as Y}from"./AuthenticatedLayout.b972dca3.js";import{r as y,o as J,m as tt,b as et,w as st,c as I,l as S,g as _,x as nt,J as it,u as T,I as rt,K as ot,G as at,H as lt,B as ct,M as ut,C as ht,n as dt,N as gt,e as pt,f as ft,j as mt}from"./app.b8f8a772.js";const wt="/build/assets/viewfinder.c2675b89.png";function vt(){const i=y({latitude:0,longitude:0}),t="navigator"in window&&"geolocation"in navigator;let e=null;return J(()=>{t&&(e=navigator.geolocation.watchPosition(s=>i.value=s.coords))}),tt(()=>{e&&navigator.geolocation.clearWatch(e)}),{coords:i,isSupported:t}}var N=function i(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var s,n,r;if(Array.isArray(t)){if(s=t.length,s!=e.length)return!1;for(n=s;n--!==0;)if(!i(t[n],e[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===e.toString();if(r=Object.keys(t),s=r.length,s!==Object.keys(e).length)return!1;for(n=s;n--!==0;)if(!Object.prototype.hasOwnProperty.call(e,r[n]))return!1;for(n=s;n--!==0;){var a=r[n];if(!i(t[a],e[a]))return!1}return!0}return t!==t&&e!==e};function $(i,t,e,s,n,r){if(n-s<=e)return;const a=s+n>>1;H(i,t,a,s,n,r%2),$(i,t,e,s,a-1,r+1),$(i,t,e,a+1,n,r+1)}function H(i,t,e,s,n,r){for(;n>s;){if(n-s>600){const l=n-s+1,u=e-s+1,h=Math.log(l),d=.5*Math.exp(2*h/3),g=.5*Math.sqrt(h*d*(l-d)/l)*(u-l/2<0?-1:1),p=Math.max(s,Math.floor(e-u*d/l+g)),m=Math.min(n,Math.floor(e+(l-u)*d/l+g));H(i,t,e,p,m,r)}const a=t[2*e+r];let c=s,o=n;for(P(i,t,s,e),t[2*n+r]>a&&P(i,t,s,n);c<o;){for(P(i,t,c,o),c++,o--;t[2*c+r]<a;)c++;for(;t[2*o+r]>a;)o--}t[2*s+r]===a?P(i,t,s,o):(o++,P(i,t,o,n)),o<=e&&(s=o+1),e<=o&&(n=o-1)}}function P(i,t,e,s){D(i,e,s),D(t,2*e,2*s),D(t,2*e+1,2*s+1)}function D(i,t,e){const s=i[t];i[t]=i[e],i[e]=s}function xt(i,t,e,s,n,r,a){const c=[0,i.length-1,0],o=[];let l,u;for(;c.length;){const h=c.pop(),d=c.pop(),g=c.pop();if(d-g<=a){for(let f=g;f<=d;f++)l=t[2*f],u=t[2*f+1],l>=e&&l<=n&&u>=s&&u<=r&&o.push(i[f]);continue}const p=Math.floor((g+d)/2);l=t[2*p],u=t[2*p+1],l>=e&&l<=n&&u>=s&&u<=r&&o.push(i[p]);const m=(h+1)%2;(h===0?e<=l:s<=u)&&(c.push(g),c.push(p-1),c.push(m)),(h===0?n>=l:r>=u)&&(c.push(p+1),c.push(d),c.push(m))}return o}function yt(i,t,e,s,n,r){const a=[0,i.length-1,0],c=[],o=n*n;for(;a.length;){const l=a.pop(),u=a.pop(),h=a.pop();if(u-h<=r){for(let f=h;f<=u;f++)z(t[2*f],t[2*f+1],e,s)<=o&&c.push(i[f]);continue}const d=Math.floor((h+u)/2),g=t[2*d],p=t[2*d+1];z(g,p,e,s)<=o&&c.push(i[d]);const m=(l+1)%2;(l===0?e-n<=g:s-n<=p)&&(a.push(h),a.push(d-1),a.push(m)),(l===0?e+n>=g:s+n>=p)&&(a.push(d+1),a.push(u),a.push(m))}return c}function z(i,t,e,s){const n=i-e,r=t-s;return n*n+r*r}const _t=i=>i[0],Mt=i=>i[1];class U{constructor(t,e=_t,s=Mt,n=64,r=Float64Array){this.nodeSize=n,this.points=t;const a=t.length<65536?Uint16Array:Uint32Array,c=this.ids=new a(t.length),o=this.coords=new r(t.length*2);for(let l=0;l<t.length;l++)c[l]=l,o[2*l]=e(t[l]),o[2*l+1]=s(t[l]);$(c,o,n,0,c.length-1,0)}range(t,e,s,n){return xt(this.ids,this.coords,t,e,s,n,this.nodeSize)}within(t,e,s){return yt(this.ids,this.coords,t,e,s,this.nodeSize)}}const kt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:i=>i},A=Math.fround||(i=>t=>(i[0]=+t,i[0]))(new Float32Array(1));class Ct{constructor(t){this.options=b(Object.create(kt),t),this.trees=new Array(this.options.maxZoom+1)}load(t){const{log:e,minZoom:s,maxZoom:n,nodeSize:r}=this.options;e&&console.time("total time");const a=`prepare ${t.length} points`;e&&console.time(a),this.points=t;let c=[];for(let o=0;o<t.length;o++)!t[o].geometry||c.push(It(t[o],o));this.trees[n+1]=new U(c,G,K,r,Float32Array),e&&console.timeEnd(a);for(let o=n;o>=s;o--){const l=+Date.now();c=this._cluster(c,o),this.trees[o]=new U(c,G,K,r,Float32Array),e&&console.log("z%d: %d clusters in %dms",o,c.length,+Date.now()-l)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let s=((t[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,t[1]));let r=t[2]===180?180:((t[2]+180)%360+360)%360-180;const a=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)s=-180,r=180;else if(s>r){const u=this.getClusters([s,n,180,a],e),h=this.getClusters([-180,n,r,a],e);return u.concat(h)}const c=this.trees[this._limitZoom(e)],o=c.range(E(s),O(a),E(r),O(n)),l=[];for(const u of o){const h=c.points[u];l.push(h.numPoints?F(h):this.points[h.index])}return l}getChildren(t){const e=this._getOriginId(t),s=this._getOriginZoom(t),n="No cluster with the specified id.",r=this.trees[s];if(!r)throw new Error(n);const a=r.points[e];if(!a)throw new Error(n);const c=this.options.radius/(this.options.extent*Math.pow(2,s-1)),o=r.within(a.x,a.y,c),l=[];for(const u of o){const h=r.points[u];h.parentId===t&&l.push(h.numPoints?F(h):this.points[h.index])}if(l.length===0)throw new Error(n);return l}getLeaves(t,e,s){e=e||10,s=s||0;const n=[];return this._appendLeaves(n,t,e,s,0),n}getTile(t,e,s){const n=this.trees[this._limitZoom(t)],r=Math.pow(2,t),{extent:a,radius:c}=this.options,o=c/a,l=(s-o)/r,u=(s+1+o)/r,h={features:[]};return this._addTileFeatures(n.range((e-o)/r,l,(e+1+o)/r,u),n.points,e,s,r,h),e===0&&this._addTileFeatures(n.range(1-o/r,l,1,u),n.points,r,s,r,h),e===r-1&&this._addTileFeatures(n.range(0,l,o/r,u),n.points,-1,s,r,h),h.features.length?h:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const s=this.getChildren(t);if(e++,s.length!==1)break;t=s[0].properties.cluster_id}return e}_appendLeaves(t,e,s,n,r){const a=this.getChildren(e);for(const c of a){const o=c.properties;if(o&&o.cluster?r+o.point_count<=n?r+=o.point_count:r=this._appendLeaves(t,o.cluster_id,s,n,r):r<n?r++:t.push(c),t.length===s)break}return r}_addTileFeatures(t,e,s,n,r,a){for(const c of t){const o=e[c],l=o.numPoints;let u,h,d;if(l)u=W(o),h=o.x,d=o.y;else{const m=this.points[o.index];u=m.properties,h=E(m.geometry.coordinates[0]),d=O(m.geometry.coordinates[1])}const g={type:1,geometry:[[Math.round(this.options.extent*(h*r-s)),Math.round(this.options.extent*(d*r-n))]],tags:u};let p;l?p=o.id:this.options.generateId?p=o.index:this.points[o.index].id&&(p=this.points[o.index].id),p!==void 0&&(g.id=p),a.features.push(g)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,e){const s=[],{radius:n,extent:r,reduce:a,minPoints:c}=this.options,o=n/(r*Math.pow(2,e));for(let l=0;l<t.length;l++){const u=t[l];if(u.zoom<=e)continue;u.zoom=e;const h=this.trees[e+1],d=h.within(u.x,u.y,o),g=u.numPoints||1;let p=g;for(const m of d){const f=h.points[m];f.zoom>e&&(p+=f.numPoints||1)}if(p>g&&p>=c){let m=u.x*g,f=u.y*g,k=a&&g>1?this._map(u,!0):null;const w=(l<<5)+(e+1)+this.points.length;for(const v of d){const x=h.points[v];if(x.zoom<=e)continue;x.zoom=e;const R=x.numPoints||1;m+=x.x*R,f+=x.y*R,x.parentId=w,a&&(k||(k=this._map(u,!0)),a(k,this._map(x)))}u.parentId=w,s.push(Pt(m/p,f/p,w,p,k))}else if(s.push(u),p>1)for(const m of d){const f=h.points[m];f.zoom<=e||(f.zoom=e,s.push(f))}}return s}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e){if(t.numPoints)return e?b({},t.properties):t.properties;const s=this.points[t.index].properties,n=this.options.map(s);return e&&n===s?b({},n):n}}function Pt(i,t,e,s,n){return{x:A(i),y:A(t),zoom:1/0,id:e,parentId:-1,numPoints:s,properties:n}}function It(i,t){const[e,s]=i.geometry.coordinates;return{x:A(E(e)),y:A(O(s)),zoom:1/0,index:t,parentId:-1}}function F(i){return{type:"Feature",id:i.id,properties:W(i),geometry:{type:"Point",coordinates:[bt(i.x),Lt(i.y)]}}}function W(i){const t=i.numPoints,e=t>=1e4?`${Math.round(t/1e3)}k`:t>=1e3?`${Math.round(t/100)/10}k`:t;return b(b({},i.properties),{cluster:!0,cluster_id:i.id,point_count:t,point_count_abbreviated:e})}function E(i){return i/360+.5}function O(i){const t=Math.sin(i*Math.PI/180),e=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return e<0?0:e>1?1:e}function bt(i){return(i-.5)*360}function Lt(i){const t=(180-i*360)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function b(i,t){for(const e in t)i[e]=t[e];return i}function G(i){return i.x}function K(i){return i.y}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function B(i,t){var e={};for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&t.indexOf(s)<0&&(e[s]=i[s]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(i);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(i,s[n])&&(e[s[n]]=i[s[n]]);return e}class Z{constructor({markers:t,position:e}){this.markers=t,e&&(e instanceof google.maps.LatLng?this._position=e:this._position=new google.maps.LatLng(e))}get bounds(){if(!(this.markers.length===0&&!this._position))return this.markers.reduce((t,e)=>t.extend(e.getPosition()),new google.maps.LatLngBounds(this._position,this._position))}get position(){return this._position||this.bounds.getCenter()}get count(){return this.markers.filter(t=>t.getVisible()).length}push(t){this.markers.push(t)}delete(){this.marker&&(this.marker.setMap(null),delete this.marker),this.markers.length=0}}const q=(i,t,e,s)=>{const n=X(i.getBounds(),t,s);return e.filter(r=>n.contains(r.getPosition()))},X=(i,t,e)=>{const{northEast:s,southWest:n}=Et(i,t),r=Ot({northEast:s,southWest:n},e);return At(r,t)},St=(i,t)=>{const s=(t.lat-i.lat)*Math.PI/180,n=(t.lng-i.lng)*Math.PI/180,r=Math.sin(s/2)*Math.sin(s/2)+Math.cos(i.lat*Math.PI/180)*Math.cos(t.lat*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))},Et=(i,t)=>({northEast:t.fromLatLngToDivPixel(i.getNorthEast()),southWest:t.fromLatLngToDivPixel(i.getSouthWest())}),Ot=({northEast:i,southWest:t},e)=>(i.x+=e,i.y-=e,t.x-=e,t.y+=e,{northEast:i,southWest:t}),At=({northEast:i,southWest:t},e)=>{const s=new google.maps.LatLngBounds;return s.extend(e.fromDivPixelToLatLng(i)),s.extend(e.fromDivPixelToLatLng(t)),s};class Q{constructor({maxZoom:t=16}){this.maxZoom=t}noop({markers:t}){return Tt(t)}}class Zt extends Q{constructor(t){var{viewportPadding:e=60}=t,s=B(t,["viewportPadding"]);super(s),this.viewportPadding=60,this.viewportPadding=e}calculate({markers:t,map:e,mapCanvasProjection:s}){return e.getZoom()>=this.maxZoom?{clusters:this.noop({markers:t,map:e,mapCanvasProjection:s}),changed:!1}:{clusters:this.cluster({markers:q(e,s,t,this.viewportPadding),map:e,mapCanvasProjection:s})}}}const Tt=i=>i.map(e=>new Z({position:e.getPosition(),markers:[e]}));class Dt extends Zt{constructor(t){var{maxDistance:e=4e4,gridSize:s=40}=t,n=B(t,["maxDistance","gridSize"]);super(n),this.clusters=[],this.maxDistance=e,this.gridSize=s,this.state={zoom:null}}calculate({markers:t,map:e,mapCanvasProjection:s}){const n={zoom:e.getZoom()};let r=!1;return this.state.zoom>this.maxZoom&&n.zoom>this.maxZoom||(r=!N(this.state,n)),this.state=n,e.getZoom()>=this.maxZoom?{clusters:this.noop({markers:t,map:e,mapCanvasProjection:s}),changed:r}:{clusters:this.cluster({markers:q(e,s,t,this.viewportPadding),map:e,mapCanvasProjection:s})}}cluster({markers:t,map:e,mapCanvasProjection:s}){return this.clusters=[],t.forEach(n=>{this.addToClosestCluster(n,e,s)}),this.clusters}addToClosestCluster(t,e,s){let n=this.maxDistance,r=null;for(let a=0;a<this.clusters.length;a++){const c=this.clusters[a],o=St(c.bounds.getCenter().toJSON(),t.getPosition().toJSON());o<n&&(n=o,r=c)}if(r&&X(r.bounds,s,this.gridSize).contains(t.getPosition()))r.push(t);else{const a=new Z({markers:[t]});this.clusters.push(a)}}}class Nt extends Q{constructor(t){var{maxZoom:e,radius:s=60}=t,n=B(t,["maxZoom","radius"]);super({maxZoom:e}),this.superCluster=new Ct(Object.assign({maxZoom:this.maxZoom,radius:s},n)),this.state={zoom:null}}calculate(t){let e=!1;if(!N(t.markers,this.markers)){e=!0,this.markers=[...t.markers];const n=this.markers.map(r=>({type:"Feature",geometry:{type:"Point",coordinates:[r.getPosition().lng(),r.getPosition().lat()]},properties:{marker:r}}));this.superCluster.load(n)}const s={zoom:t.map.getZoom()};return e||this.state.zoom>this.maxZoom&&s.zoom>this.maxZoom||(e=e||!N(this.state,s)),this.state=s,e&&(this.clusters=this.cluster(t)),{clusters:this.clusters,changed:e}}cluster({map:t}){return this.superCluster.getClusters([-180,-90,180,90],Math.round(t.getZoom())).map(this.transformCluster.bind(this))}transformCluster({geometry:{coordinates:[t,e]},properties:s}){if(s.cluster)return new Z({markers:this.superCluster.getLeaves(s.cluster_id,1/0).map(n=>n.properties.marker),position:new google.maps.LatLng({lat:e,lng:t})});{const n=s.marker;return new Z({markers:[n],position:n.getPosition()})}}}class $t{constructor(t,e){this.markers={sum:t.length};const s=e.map(r=>r.count),n=s.reduce((r,a)=>r+a,0);this.clusters={count:e.length,markers:{mean:n/e.length,sum:n,min:Math.min(...s),max:Math.max(...s)}}}}class Bt{render({count:t,position:e},s){const n=t>Math.max(10,s.clusters.markers.mean)?"#ff0000":"#0000ff",r=window.btoa(`
  <svg fill="${n}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240">
    <circle cx="120" cy="120" opacity=".6" r="70" />
    <circle cx="120" cy="120" opacity=".3" r="90" />
    <circle cx="120" cy="120" opacity=".2" r="110" />
  </svg>`);return new google.maps.Marker({position:e,icon:{url:`data:image/svg+xml;base64,${r}`,scaledSize:new google.maps.Size(45,45)},label:{text:String(t),color:"rgba(255,255,255,0.9)",fontSize:"12px"},title:`Cluster of ${t} markers`,zIndex:Number(google.maps.Marker.MAX_ZINDEX)+t})}}function jt(i,t){for(let e in t.prototype)i.prototype[e]=t.prototype[e]}class j{constructor(){jt(j,google.maps.OverlayView)}}var L;(function(i){i.CLUSTERING_BEGIN="clusteringbegin",i.CLUSTERING_END="clusteringend",i.CLUSTER_CLICK="click"})(L||(L={}));const Rt=(i,t,e)=>{e.fitBounds(t.bounds)};class zt extends j{constructor({map:t,markers:e=[],algorithm:s=new Nt({}),renderer:n=new Bt,onClusterClick:r=Rt}){super(),this.markers=[...e],this.clusters=[],this.algorithm=s,this.renderer=n,this.onClusterClick=r,t&&this.setMap(t)}addMarker(t,e){this.markers.includes(t)||(this.markers.push(t),e||this.render())}addMarkers(t,e){t.forEach(s=>{this.addMarker(s,!0)}),e||this.render()}removeMarker(t,e){const s=this.markers.indexOf(t);return s===-1?!1:(t.setMap(null),this.markers.splice(s,1),e||this.render(),!0)}removeMarkers(t,e){let s=!1;return t.forEach(n=>{s=this.removeMarker(n,!0)||s}),s&&!e&&this.render(),s}clearMarkers(t){this.markers.length=0,t||this.render()}render(){const t=this.getMap();if(t instanceof google.maps.Map&&this.getProjection()){google.maps.event.trigger(this,L.CLUSTERING_BEGIN,this);const{clusters:e,changed:s}=this.algorithm.calculate({markers:this.markers,map:t,mapCanvasProjection:this.getProjection()});(s||s==null)&&(this.reset(),this.clusters=e,this.renderClusters()),google.maps.event.trigger(this,L.CLUSTERING_END,this)}}onAdd(){this.idleListener=this.getMap().addListener("idle",this.render.bind(this)),this.render()}onRemove(){google.maps.event.removeListener(this.idleListener),this.reset()}reset(){this.markers.forEach(t=>t.setMap(null)),this.clusters.forEach(t=>t.delete()),this.clusters=[]}renderClusters(){const t=new $t(this.markers,this.clusters),e=this.getMap();this.clusters.forEach(s=>{s.markers.length===1?s.marker=s.markers[0]:(s.marker=this.renderer.render(s,t),this.onClusterClick&&s.marker.addListener("click",n=>{google.maps.event.trigger(this,L.CLUSTER_CLICK,s),this.onClusterClick(n,s,e)})),s.marker.setMap(e)})}}var Ut=function i(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var s,n,r;if(Array.isArray(t)){if(s=t.length,s!=e.length)return!1;for(n=s;n--!==0;)if(!i(t[n],e[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===e.toString();if(r=Object.keys(t),s=r.length,s!==Object.keys(e).length)return!1;for(n=s;n--!==0;)if(!Object.prototype.hasOwnProperty.call(e,r[n]))return!1;for(n=s;n--!==0;){var a=r[n];if(!i(t[a],e[a]))return!1}return!0}return t!==t&&e!==e};const V="__googleMapsScriptId";var C;(function(i){i[i.INITIALIZED=0]="INITIALIZED",i[i.LOADING=1]="LOADING",i[i.SUCCESS=2]="SUCCESS",i[i.FAILURE=3]="FAILURE"})(C||(C={}));class M{constructor({apiKey:t,authReferrerPolicy:e,channel:s,client:n,id:r=V,language:a,libraries:c=[],mapIds:o,nonce:l,region:u,retries:h=3,url:d="https://maps.googleapis.com/maps/api/js",version:g}){if(this.CALLBACK="__googleMapsCallback",this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=t,this.authReferrerPolicy=e,this.channel=s,this.client=n,this.id=r||V,this.language=a,this.libraries=c,this.mapIds=o,this.nonce=l,this.region=u,this.retries=h,this.url=d,this.version=g,M.instance){if(!Ut(this.options,M.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(M.instance.options)}`);return M.instance}M.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?C.FAILURE:this.done?C.SUCCESS:this.loading?C.LOADING:C.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let t=this.url;return t+=`?callback=${this.CALLBACK}`,this.apiKey&&(t+=`&key=${this.apiKey}`),this.channel&&(t+=`&channel=${this.channel}`),this.client&&(t+=`&client=${this.client}`),this.libraries.length>0&&(t+=`&libraries=${this.libraries.join(",")}`),this.language&&(t+=`&language=${this.language}`),this.region&&(t+=`&region=${this.region}`),this.version&&(t+=`&v=${this.version}`),this.mapIds&&(t+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(t+=`&auth_referrer_policy=${this.authReferrerPolicy}`),t}deleteScript(){const t=document.getElementById(this.id);t&&t.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((t,e)=>{this.loadCallback(s=>{s?e(s.error):t(window.google)})})}loadCallback(t){this.callbacks.push(t),this.execute()}setScript(){if(document.getElementById(this.id)){this.callback();return}const t=this.createUrl(),e=document.createElement("script");e.id=this.id,e.type="text/javascript",e.src=t,e.onerror=this.loadErrorCallback.bind(this),e.defer=!0,e.async=!0,this.nonce&&(e.nonce=this.nonce),document.head.appendChild(e)}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(t){if(this.errors.push(t),this.errors.length<=this.retries){const e=this.errors.length*Math.pow(2,this.errors.length);console.log(`Failed to load Google Maps script, retrying in ${e} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},e)}else this.onerrorEvent=t,this.callback()}setCallback(){window.__googleMapsCallback=this.callback.bind(this)}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(t=>{t(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader.This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading||(this.loading=!0,this.setCallback(),this.setScript())}}}const Ft={class:"flex items-top justify-center"},Gt={class:"shadow-md rounded-sm overflow-hidden"},Kt=["onKeyup"],Vt={key:0,class:"suggest-box z-10 relative border"},Jt=["onClick"],Ht=_("i",{class:"fas fa-search invert-[40%] hover:invert-0"},null,-1),Wt=[Ht],qt={__name:"SearchBar",props:{salesPoints:Object},emits:["inputVal"],setup(i,{emit:t}){const e=i;let s=y([]),n=y([]),r=et({});st(n,l=>{let u=l.split(" ");l.length>=1?s.value=e.salesPoints.filter(h=>{let d=y(!0);return u.forEach(g=>{h.taxonomy.toLowerCase().includes(g.toLowerCase())||(d.value=!1)}),d.value}):s.value=[]});const a=()=>{t("inputVal",r),n.value="",r={}},c=l=>{r=[l],a()},o=()=>{r=s.value,a()};return(l,u)=>(I(),S("div",Ft,[_("div",Gt,[nt(_("input",{"onUpdate:modelValue":u[0]||(u[0]=h=>rt(n)?n.value=h:n=h),type:"text",id:"search",placeholder:"Cerca un punto vendita",onKeyup:ot(o,["enter"]),class:"w-96 focus:ring-0 border-transparent focus:border-transparent"},null,40,Kt),[[it,T(n)]]),T(s).length>=1?(I(),S("div",Vt,[(I(!0),S(at,null,lt(T(s),h=>(I(),S("div",{key:h.id,onClick:d=>c(h),class:"suggest-item bg-white text-xs text-gray-400 py-2 px-3 hover:bg-slate-100 cursor-pointer"},ct(h.taxonomy),9,Jt))),128))])):ut("",!0)]),_("div",{class:"ml-3 w-10 h-10 flex justify-center items-center cursor-pointer bg-white shadow-md rounded-sm text-lg",onClick:o},Wt)]))}};const Xt={class:"absolute top-3 left-3 z-50"},Qt=_("img",{class:"h-7 w-7 invert-[40%] hover:invert-0",src:wt,alt:"viewfinder"},null,-1),Yt=[Qt],se={__name:"MapsPage",props:{records:Object},setup(i){const t=i;let e=y(null);const s=y(null);let n=y(null),r=y(null),a=y(null),c=y(null);const o=ht(),l="AIzaSyB-0a4hmJCOTEt7t-Uk-FnZR1NJHaNg0TA",u=new M({apiKey:l}),{coords:h}=vt(),d=y({lat:42.74501513597965,lng:12.925451711217713}),g=dt(()=>({lat:h.value.latitude,lng:h.value.longitude})),p=w=>{w.length==1?(n=w.map(v=>{const x=new google.maps.Marker({position:{lat:v.latitude/1,lng:v.longitude/1}});return m(x,v),x}),c.clearMarkers(),c.addMarkers(n),o.success("Punto vendita trovato",{timeout:5e3})):w.length>1?(n=w.map(v=>{const x=new google.maps.Marker({position:{lat:v.latitude/1,lng:v.longitude/1}});return m(x,v),x}),c.clearMarkers(),c.addMarkers(n),o.success("Punti vendita trovati",{timeout:5e3})):o.error("Nessun punto vendita trovato",{timeout:5e3})};J(async()=>{await u.load(),a=new google.maps.Map(s.value,{mapId:"2c13413f5730d1f4",center:d.value,zoom:6,mapTypeControl:!1,streetViewControl:!1}),r=new google.maps.InfoWindow({content:"",disableAutoPan:!0}),n=t.records.map(v=>{const x=new google.maps.Marker({position:{lat:v.latitude/1,lng:v.longitude/1}});return m(x,v),x});let w=new Dt({gridSize:20});c=new zt({map:a,markers:n,algorithm:w})}),document.addEventListener("click",w=>{w.target.classList.contains("btn-marker")&&gt.Inertia.get(`sales-point/${w.target.id}/edit`)});const m=(w,v)=>{w.addListener("click",()=>{r.setContent(f(v)),r.open(a,w),a.setCenter({lat:v.latitude/1,lng:v.longitude/1})})},f=w=>`<div class="infowindow-box">
                        <div class="title">${w.name}</div>
                        <div class="description">${w.description}</div>
                        <button id="${w.id}" class="btn-marker">Leggi documenti</button>
                    </div>`,k=()=>{e.value!==null&&e.setMap(null),e=new google.maps.Marker({position:g.value,map:a,icon:"http://127.0.0.1:8000/public/images/icons/point.svg"}),a.setCenter(g.value),a.setZoom(17)};return(w,v)=>(I(),pt(Y,null,{default:ft(()=>[_("div",Xt,[mt(qt,{onInputVal:p,salesPoints:t.records},null,8,["salesPoints"])]),_("div",null,[_("div",{class:"absolute bottom-28 right-[10px] z-50 h-10 w-10 flex justify-center items-center cursor-pointer bg-white shadow-[0_1px_4px_-1px_rgb(0 0 0 / 30%] rounded-sm",onClick:k},Yt)]),_("div",{ref_key:"mapDiv",ref:s,class:"maps h-full w-full"},null,512)]),_:1}))}};export{se as default};
